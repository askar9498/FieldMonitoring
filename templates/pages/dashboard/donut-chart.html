{% block dount_chart %}
<div class="chart-container" id="gas-production-chart">
    <div id="donut-chart" style="height: 400px; width:400px;"></div>
</div>
{% endblock dount_chart %}
{% block dount_chart_js %}

<script>
    function renderDonutChart() {
        var chartDom = document.getElementById('donut-chart');
        var myChart = echarts.init(chartDom);
        
        var productionData = {{ production_data|safe }};
        var chartData = productionData.map(item => ({ name: item.company, value: item.gas }));
        
        var option = {
            tooltip: {
                trigger: 'item',
                formatter: function (params) {
                    return `${params.name}: ${params.value} (${params.percent}%)`;
                }
            },
            legend: {
                orient: 'vertical',
                left: 'left',
                data: chartData.map(item => item.name)
            },
            series: [
                {
                    name: 'Gas Production',
                    type: 'pie',
                    radius: ['40%', '70%'],
                    avoidLabelOverlap: false,
                    itemStyle: {
                        borderRadius: 10,
                        borderColor: '#fff',
                        borderWidth: 2
                    },
                    label: {
                        show: true,
                        position: 'center',
                        fontSize: '16',
                        fontWeight: '600'
                    },
                    emphasis: {
                        label: {
                            show: true,
                            fontSize: '20',
                            fontWeight: 'bold'
                        }
                    },
                    data: chartData
                }
            ]
        };
        
        myChart.setOption(option);
    }

    document.addEventListener('DOMContentLoaded', function () {
        renderDonutChart();
    });

    document.addEventListener('htmx:afterSwap', function (event) {
        if (event.target.id === 'gas-production-chart' || event.target.querySelector('#gas-production-chart')) {
            renderDonutChart();
        }
    });
</script>
{% endblock dount_chart_js %}